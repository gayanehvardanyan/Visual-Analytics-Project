<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="assets/jquery.dropdown.min.css">
    <link rel="stylesheet" href="assets/main.css"/>
    <meta charset="UTF-8">
    <title>Visual Analytics - Health Care Visualization</title>

    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>
    <!-- CSS -->
    <!-- CSS -->
    <!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"-->
    <!--          integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">-->
    <!-- jQuery and JS bundle w/ Popper.js -->
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ho+j7jyWK8fNQe+A12Hb8AhRq26LrZ/JpcUGGOn+Y7RsweNrtN/tE3MoK7ZeZDyx"
            crossorigin="anonymous"></script>
    <script src="https://d3js.org/d3.v4.js"></script>
    <script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
    <script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="assets/jquery.dropdown.min.js"></script>
    <script src="assets/jquery.scrollify.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.2/Chart.js"></script>
    <script>
        $(function () {
            $.scrollify({
                section: ".panel",
                scrollSpeed: 1100,
            });

            $(".scroll,.scroll-btn").click(function (e) {
                e.preventDefault();

                $.scrollify.next();
            });
        });

    </script>
</head>
<body>
<section class="panel home">
    <div class="inner">
        <header>
            <h1>
                How Much Does Health Care Cost?
            </h1>
            <p class="tagline">Discover everything about the financial aspect of healthcare around the world.</p>
        </header>
        <a href="#overview" class="scroll">Scroll for more</a>
    </div>
</section>
<section class="panel heightless" data-section-name="overview" id="overview">
    <div class="inner">
        <p></p>
        <h2>Does Financial Aid Governments Receive Contribute to People's health?</h2>
        
        <p class="tagline">
            When a country accepted more aid, does the amount of health spending also increase? We collect data from the World Bank, and you can check it by clicking the country on the map. Later, the 2 line charts on the right will show you the amount of received financial aid and the health expenditure per capita from 2008 to 2018 for the country you select.  
        </br>
        </br>Hint: 
        The map itself is color encoded using the death rate, you will see at the bottom the country name and death rate by hovering over. For the line charts, hovering overcan see the exact amount every year. 



        </p>
   
        <div>
            <div class="grid-container">
                
                
                <div class="grid-child">
                    <svg id="map" width="550" height="400"></svg>
                </div>
                <div class="grid-child">
                    <svg id="line" width="550" height="200"></svg>
                    <svg id="line2" width="550" height="200"></svg>
                   
                </div>
              <!--   <div class="grid-child">
                    
                </div> -->
               

            </div>
           
                
           
        </div>
    </div>
</section>
<section class="panel heightless">
    <div class="inner">
        <header>
            <p></p>
            <h2>World's Health Financial Situation at Glance</h2>
            <p class="tagline">Select the year from the dropdown button to view the top 20 countries that received the most general financial aid, and another 20 nations have the highest health expenditure per capita per country in USD.</p>
            <select id="selectButton" class="block-select"></select>
        </header>

        
        <div class="grid-container">
            <div class="grid-child">
                <h3 class="alignBar">Financial aid received</h3>
                <svg id="Barchart_received" width="550" height="400"></svg>
            </div>
            <div class="grid-child">
                <h3 class="alignBar">Health expenditure per capital</h3>
                <svg id="Barchart_spend" width="550" height="400"></svg>
            </div>
        </div>
    </div>
</section>
<section class="panel gdp">
    <div class="inner">
        <header>
            <h2>Health Care Spending by Governments (GDP) vs Individuals (Out of Pocket Expenses)</h2>
            <p class="tagline">Select up to 5 countries and click on plot to compare the spendings of the goverment out of GDP on healthcare on the first plot, and the amount each individual spends on the second</p>
        </header>
        <!-- Countries list for q3-->
        <div id="countries-select">
            <select id="countries-select-q3" style="display:none" name="countries" multiple placeholder="Select">
                <option value="Afghanistan">Afghanistan</option>
                <option value="Algeria">Algeria</option>
                <option value="Andorra">Andorra</option>
                <option value="Angola">Angola</option>
                <option value="Antigua and Barbuda">Antigua and Barbuda</option>
                <option value="Argentina">Argentina</option>
                <option value="Armenia">Armenia</option>
                <option value="Australia">Australia</option>
                <option value="Austria">Austria</option>
                <option value="Azerbaijan">Azerbaijan</option>
                <option value="Bahamas">Bahamas</option>
                <option value="Bahrain">Bahrain</option>
                <option value="Bangladesh">Bangladesh</option>
                <option value="Barbados">Barbados</option>
                <option value="Belarus">Belarus</option>
                <option value="Belgium">Belgium</option>
                <option value="Belize">Belize</option>
                <option value="Benin">Benin</option>
                <option value="Bhutan">Bhutan</option>
                <option value="Bolivia">Bolivia</option>
                <option value="Bosnia and Herzegovina">Bosnia and Herzegovina</option>
                <option value="Botswana">Botswana</option>
                <option value="Brazil">Brazil</option>
                <option value="Brunei Darussalam">Brunei Darussalam</option>
                <option value="Bulgaria">Bulgaria</option>
                <option value="Burkina Faso">Burkina Faso</option>
                <option value="Burundi">Burundi</option>
                <option value="Cabo Verde">Cabo Verde</option>
                <option value="Cambodia">Cambodia</option>
                <option value="Cameroon">Cameroon</option>
                <option value="Canada">Canada</option>
                <option value="Chad">Chad</option>
                <option value="Chile">Chile</option>
                <option value="China">China</option>
                <option value="Colombia">Colombia</option>
                <option value="Comoros">Comoros</option>
                <option value="Congo">Congo</option>
                <option value="Costa Rica">Costa Rica</option>
                <option value="Cote d'Ivoire">Cote d'Ivoire</option>
                <option value="Croatia">Croatia</option>
                <option value="Cuba">Cuba</option>
                <option value="Cyprus">Cyprus</option>
                <option value="Czech Republic">Czech Republic</option>
                <option value="Denmark">Denmark</option>
                <option value="Djibouti">Djibouti</option>
                <option value="Dominica">Dominica</option>
                <option value="Dominican Republic">Dominican Republic</option>
                <option value="Ecuador">Ecuador</option>
                <option value="Egypt">Egypt</option>
                <option value="El Salvador">El Salvador</option>
                <option value="Equatorial Guinea">Equatorial Guinea</option>
                <option value="Eritrea">Eritrea</option>
                <option value="Estonia">Estonia</option>
                <option value="Eswatini">Eswatini</option>
                <option value="Ethiopia">Ethiopia</option>
                <option value="Fiji">Fiji</option>
                <option value="Finland">Finland</option>
                <option value="France">France</option>
                <option value="Gabon">Gabon</option>
                <option value="Gambia">Gambia</option>
                <option value="Georgia">Georgia</option>
                <option value="Germany">Germany</option>
                <option value="Ghana">Ghana</option>
                <option value="Greece">Greece</option>
                <option value="Grenada">Grenada</option>
                <option value="Guatemala">Guatemala</option>
                <option value="Guinea">Guinea</option>
                <option value="Guinea-Bissau">Guinea-Bissau</option>
                <option value="Guyana">Guyana</option>
                <option value="Haiti">Haiti</option>
                <option value="Honduras">Honduras</option>
                <option value="Hungary">Hungary</option>
                <option value="Iceland">Iceland</option>
                <option value="India">India</option>
                <option value="Indonesia">Indonesia</option>
                <option value="Iran">Iran</option>
                <option value="Iraq">Iraq</option>
                <option value="Ireland">Ireland</option>
                <option value="Israel">Israel</option>
                <option value="Italy">Italy</option>
                <option value="Jamaica">Jamaica</option>
                <option value="Japan">Japan</option>
                <option value="Jordan">Jordan</option>
                <option value="Kazakhstan">Kazakhstan</option>
                <option value="Kenya">Kenya</option>
                <option value="Kiribati">Kiribati</option>
                <option value="Korea">Korea</option>
                <option value="Kuwait">Kuwait</option>
                <option value="Kyrgyz Republic">Kyrgyz Republic</option>
                <option value="Lao PDR">Lao PDR</option>
                <option value="Latvia">Latvia</option>
                <option value="Lebanon">Lebanon</option>
                <option value="Lesotho">Lesotho</option>
                <option value="Liberia">Liberia</option>
                <option value="Libya">Libya</option>
                <option value="Lithuania">Lithuania</option>
                <option value="Luxembourg">Luxembourg</option>
                <option value="Madagascar">Madagascar</option>
                <option value="Malawi">Malawi</option>
                <option value="Malaysia">Malaysia</option>
                <option value="Maldives">Maldives</option>
                <option value="Mali">Mali</option>
                <option value="Malta">Malta</option>
                <option value="Marshall Islands">Marshall Islands</option>
                <option value="Mauritania">Mauritania</option>
                <option value="Mauritius">Mauritius</option>
                <option value="Mexico">Mexico</option>
                <option value="Micronesia">Micronesia</option>
                <option value="Moldova">Moldova</option>
                <option value="Monaco">Monaco</option>
                <option value="Mongolia">Mongolia</option>
                <option value="Morocco">Morocco</option>
                <option value="Mozambique">Mozambique</option>
                <option value="Myanmar">Myanmar</option>
                <option value="Namibia">Namibia</option>
                <option value="Nauru">Nauru</option>
                <option value="Nepal">Nepal</option>
                <option value="Netherlands">Netherlands</option>
                <option value="New Zealand">New Zealand</option>
                <option value="Nicaragua">Nicaragua</option>
                <option value="Niger">Niger</option>
                <option value="Nigeria">Nigeria</option>
                <option value="North America">North America</option>
                <option value="North Macedonia">North Macedonia</option>
                <option value="Norway">Norway</option>
                <option value="Oman">Oman</option>
                <option value="Pakistan">Pakistan</option>
                <option value="Palau">Palau</option>
                <option value="Panama">Panama</option>
                <option value="Papua New Guinea">Papua New Guinea</option>
                <option value="Paraguay">Paraguay</option>
                <option value="Peru">Peru</option>
                <option value="Philippines">Philippines</option>
                <option value="Poland">Poland</option>
                <option value="Portugal">Portugal</option>
                <option value="Qatar">Qatar</option>
                <option value="Romania">Romania</option>
                <option value="Russian Federation">Russian Federation</option>
                <option value="Rwanda">Rwanda</option>
                <option value="Samoa">Samoa</option>
                <option value="San Marino">San Marino</option>
                <option value="Sao Tome and Principe">Sao Tome and Principe</option>
                <option value="Saudi Arabia">Saudi Arabia</option>
                <option value="Senegal">Senegal</option>
                <option value="Serbia">Serbia</option>
                <option value="Seychelles">Seychelles</option>
                <option value="Sierra Leone">Sierra Leone</option>
                <option value="Singapore">Singapore</option>
                <option value="Slovak Republic">Slovak Republic</option>
                <option value="Slovenia">Slovenia</option>
                <option value="Solomon Islands">Solomon Islands</option>
                <option value="South Africa">South Africa</option>
                <option value="Spain">Spain</option>
                <option value="Sri Lanka">Sri Lanka</option>
                <option value="St. Kitts and Nevis">St. Kitts and Nevis</option>
                <option value="St. Lucia">St. Lucia</option>
                <option value="St. Vincent and the Grenadines">St. Vincent and the Grenadines</option>
                <option value="Sudan">Sudan</option>
                <option value="Suriname">Suriname</option>
                <option value="Sweden">Sweden</option>
                <option value="Switzerland">Switzerland</option>
                <option value="Syrian Arab Republic">Syrian Arab Republic</option>
                <option value="Tajikistan">Tajikistan</option>
                <option value="Tanzania">Tanzania</option>
                <option value="Thailand">Thailand</option>
                <option value="Timor-Leste">Timor-Leste</option>
                <option value="Togo">Togo</option>
                <option value="Tonga">Tonga</option>
                <option value="Trinidad and Tobago">Trinidad and Tobago</option>
                <option value="Tunisia">Tunisia</option>
                <option value="Turkey">Turkey</option>
                <option value="Turkmenistan">Turkmenistan</option>
                <option value="Tuvalu">Tuvalu</option>
                <option value="Uganda">Uganda</option>
                <option value="Ukraine">Ukraine</option>
                <option value="United Arab Emirates">United Arab Emirates</option>
                <option value="United Kingdom">United Kingdom</option>
                <option value="United States">United States</option>
                <option value="Uruguay">Uruguay</option>
                <option value="Uzbekistan">Uzbekistan</option>
                <option value="Vanuatu">Vanuatu</option>
                <option value="Venezuela">Venezuela</option>
                <option value="Vietnam">Vietnam</option>
                <option value="Yemen">Yemen</option>
                <option value="Zambia">Zambia</option>
                <option value="Zimbabwe">Zimbabwe</option>
            </select>
        </div>
        <button type="button" class="plot-button" id="plot-button-q3">Plot
        </button>
        <div id='gdpDiv'>            <!-- Plot for Health Care spending as % of GDP -->
        </div>
        <div id='oopDiv'>            <!-- Plot for Health Care spending as % of GDP -->
        </div>
    </div>
</section>
<section class="panel heightless">
    <div class="inner">
        <header>
            <h2>How Many Hospital Beds are there per 10,000 Thousand People in Each Country?</h2>
        </header>
        <canvas id="num_beds"></canvas>
        <select id="selectYearNumBeds", onchange="showSelectedCountryDataForBeds(this)">
            <option value="2018">2018</option>
            <option value="2017">2017</option>
            <option value="2016">2016</option>
            <option value="2015">2015</option>
            <option value="2014">2014</option>
            <option value="2013">2013</option>
            <option value="2012">2012</option>
            <option value="2011">2011</option>
            <option value="2010">2010</option>
            <option value="2009">2009</option>
            <option value="2008">2008</option>
            <option value="2007">2007</option>
            <option value="2006">2006</option>
            <option value="2005">2005</option>
            <option value="2004">2004</option>
            <option value="2003">2003</option>
            <option value="2002">2002</option>
            <option value="2001">2001</option>
            <option value="2000">2000</option>
        </select>
    </div>
</section>
<section class="panel heightless">
    <div class="inner">
        <header>
            <h2>How has life expectancy changed over the years</h2>
        </header>
        <canvas id="life_expectancy"></canvas>
        <h4>Select countries to show data</h4>
        <select id="selectCountryLifeExpectancy", onchange="showSelectedCountryDataForLifeExpectancy([])" multiple>
            <option>Choose a country</option>
        </select>
</section>
<script>
    let plotly_country_selection;
    let q3_data = new Map()
    let q4_data = new Map()
    const q3_q4_years = [2000, 2001, 2002, 2003, 2004, 2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017]
    $(document).ready(function () {
        initialize();
        drop_down();
        events();
        utilization_chart();
    });

    function initialize() {
        plotly_country_selection = ['Armenia', 'Spain', 'France', 'India', 'China'];
        d3.csv("https://raw.githubusercontent.com/gayanehvardanyan/Visual-Analytics-Project/main/assets/q3_source.csv").get(function (errors, data) {
            data.forEach(x => {
                q3_data.set(x["Country Name"], q3_q4_years.map(y => parseFloat(x[y]).toFixed(2)));
            });
            q3_gdp_plot();
        });
        d3.csv("https://raw.githubusercontent.com/gayanehvardanyan/Visual-Analytics-Project/main/assets/q4_source.csv").get(function (errors, data) {
            data.forEach(x => {
                q4_data.set(x["Country"], q3_q4_years.map(y => parseFloat(x[y]).toFixed(2)));
            });
            q4_oop_plot();
        });
    }


    function events() {
        $('#plot-button-q3').click(function () {
            q3_gdp_plot();
            q4_oop_plot();
        });
    }

    function drop_down() {
        // plugin from https://www.jqueryscript.net/form/Searchable-Multi-select-jQuery-Dropdown.html
        let a = $('#countries-select').dropdown({
            readOnly: true,
            minCount: 2,
            minCountErrorMessage: 'Choose at-least 2 countries',
            limitCount: 5,
            limitCountErrorMessage: 'Choose a Maximum of 5 countries',
            input: '<input type="text" maxLength="20" placeholder="Search">',
            multipleMode: 'label',
            searchable: true,
            searchNoData: '<li style="color:#ddd">No Results</li>',
            choice: function () {
                plotly_country_selection = this.config.data.filter(x => x.selected).map(x => x.id)
            },
            extendProps: []
        });
        $("#countries-select-q3 option").removeAttr("selected");
    }

    function utilization_chart() {
        var svg = d3.select("#map"),
            width = +svg.attr("width"),
            height = +svg.attr("height");

        // Map and projection
        var path = d3.geoPath();
        var projection = d3.geoMercator()
            .scale(100)
            .center([135, 17])
        //.translate([width / 2, height / 2]);

        //Data and color scale
        var data = d3.map();
        var colorScale = d3.scaleThreshold()
            .domain([0, 3, 6, 9, 12, 15, 18])
            .range(d3.schemeBlues[8]);

        d3.queue()
            .defer(d3.json, "https://raw.githubusercontent.com/YuhsuanChen/dataset/main/geo.json")
            .defer(d3.csv, "https://raw.githubusercontent.com/YuhsuanChen/dataset/main/death_rate.csv", function (d) {
                data.set(d.Country_Code, [d.Country_Name, +d.years_sum]);
            })
            .await(mapChart);

        createLine_received("Afghanistan");
        createLine_spend("Afghanistan");

        function mapChart(error, topo) {

            //Draw the map
            svg.append("g")
                .selectAll("path")
                .data(topo.features)
                .enter()
                .append("path")
                // draw each country
                .attr("d", d3.geoPath()
                    .projection(projection)
                )
                // set the color of each country

                .attr("fill", function (d) {
                    d.value = data.get(d.id)
                    if (typeof d.value !== 'undefined') {
                        //console.log(d.value[1])
                        d.total = d.value[1] || 0;
                    } else {
                        d.total = 0
                    }
                    return colorScale(d.total);

                })
                .style("stroke", "transparent")
                .attr("class", function (d) {
                    return "Country_Code"
                })
                .style("opacity", .8)
                .on("mouseover", mouseOver)
                .on("mouseleave", mouseLeave)
                .on("click", up)
        }

        var mouseOver = function (d) {


            d3.select(this)
                .transition()
                .style("opacity", 1)
                .style("stroke", "black")

            var text = svg.append("text")
                .attr("x", (width + 10))
                .attr("y", (height + 90))
                .attr("text-anchor", "middle")
                .style("font-size", "11px")
                .attr("id", "mapTitle")
                .text(data.get(d.id)[0] + ", death rate: " + data.get(d.id)[1] + " per 1000 people");
        }

        var mouseLeave = function (d) {
            d3.selectAll(".Country_Code")
                .transition()
                .style("opacity", .8)
                .style("stroke", "transparent")
            mapTitle.remove()

        }

        function up(d, i) {
            var selectedCountry = data.get(d.id)[0];
            d3.selectAll("#lineline").remove();
            d3.selectAll("#lineChartTitle").remove();
            createLine_received(selectedCountry);
            createLine_spend(selectedCountry);
        }


        function createLine_received(selectedCountry) {

// set the dimensions and margins of the graph
            var margin = {top: 30, right: 80, bottom: 30, left: 90},
                width = 600 - margin.left - margin.right,
                height = 200 - margin.top - margin.bottom;

// append the svg object to the body of the page
            var svg = d3.select("#line")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var x = d3.scaleTime().range([0, width]);
            var y = d3.scaleLinear().range([height, 0]);
            var bisectDate = d3.bisector(function (d) {
                return d.Year;
            }).left;


//Read the data
            d3.csv("https://raw.githubusercontent.com/YuhsuanChen/dataset/main/linechart_year_updated.csv", function (data) {

                var parseTime = d3.timeParse("%Y")

                var myColor = d3.scaleOrdinal()
                    //.domain(allGroup)
                    .range(d3.schemeSet2);

                // Add X axis --> it is a date format
                x = d3.scaleLinear()
                    .domain(d3.extent(data, function (d) {
                        return d.Year;
                    }))
                    .range([0, width]);
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(10));

                // Add Y axis
                y = d3.scaleLinear()
                    .domain([d3.min(data, function (d) {
                        return +d.Value;
                    }) / 1.005,
                        d3.max(data, function (d) {
                            return +d.Value;
                        }) * 1.005])
                    .range([height, 0])
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(5))
                    .append("text")
                    .attr("class", "axis-title")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .attr("fill", "#5D6971")
                    .text("US$");

                var text = svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 0 - (margin.top / 2))
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .style("text-decoration", "underline")
                    .attr("id", "lineChartTitle")
                    .text("Financial aid received, " + selectedCountry);


                // Initialize line with first group of the list
                var line = svg
                    .append('g')
                    .append("path")
                    .datum(data.filter(function (d) {
                        return d.Country_Name == selectedCountry
                    }))
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x(d.Year)
                        })
                        .y(function (d) {
                            return y(+d.Value)
                        })
                    )
                    .attr("id", "lineline")
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-width", 4)
                    .style("fill", "none");

                var focus = svg
                    .append('g')
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("line")
                    .attr("class", "x-hover-line hover-line")
                    .attr("y1", 0)
                    .attr("y2", height)
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-dasharray", 3);

                focus.append("line")
                    .attr("class", "y-hover-line hover-line")
                    .attr("x1", width)
                    .attr("x2", width)
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-dasharray", 3);

                focus.append("circle")
                    .attr("fill", function (d) {
                        return myColor("valueA")
                    })
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .attr("r", 5);

                focus.append("text")
                    .attr("x", 5)
                    .attr("dy", ".31em");

                var rect = svg.append("rect")
                    .attr("transform", "translate(" + margin.top + ")")
                    .attr("class", "overlay")
                    .attr("width", width + 50)
                    .attr("height", height)
                    .on("mouseover", function () {
                        focus.style("display", null);
                    })
                    .on("mouseout", function () {
                        focus.style("display", "none");
                    })
                    .on("mousemove", mousemove);

                function mousemove() {
                    var filtered_data = data.filter(function (d) {
                        return d.Country_Name == selectedCountry
                    });
                    var x0 = x.invert(d3.mouse(this)[0])
                    i = bisectDate(filtered_data, x0, 1);
                    d0 = filtered_data[i - 1];
                    d1 = filtered_data[i];
                    if (typeof d1 !== 'undefined') {
                        d = x0 - d0.year > d1.year - x0 ? d1 : d0;

                    } else {
                        d = filtered_data[10]
                    }
                    focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Value) + ")");
                    focus.select("text").text(function () {
                        return d.Value;
                    });
                    focus.select(".x-hover-line").attr("y2", height - y(d.Value));
                    focus.select(".y-hover-line").attr("x2", width + width);

                }

            })


        }

        function createLine_spend(selectedCountry) {

// set the dimensions and margins of the graph
            var margin = {top: 30, right: 80, bottom: 30, left: 90},
                width = 600 - margin.left - margin.right,
                height = 200 - margin.top - margin.bottom;

// append the svg object to the body of the page
            var svg = d3.select("#line2")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform",
                    "translate(" + margin.left + "," + margin.top + ")");

            var x = d3.scaleTime().range([0, width]);
            var y = d3.scaleLinear().range([height, 0]);
            var bisectDate = d3.bisector(function (d) {
                return d.Year;
            }).left;


//Read the data
            d3.csv("https://raw.githubusercontent.com/YuhsuanChen/dataset/main/linechart_spending.csv", function (data) {
                // List of groups (here I have one group per column)
                // var allGroup = d3.map(data, function(d){return(d.Country_Name)}).keys()

                var parseTime = d3.timeParse("%Y")

                var myColor = d3.scaleOrdinal()
                    //.domain(allGroup)
                    .range(d3.schemeSet2);

                // Add X axis --> it is a date format
                x = d3.scaleLinear()
                    .domain(d3.extent(data, function (d) {
                        return d.Year;
                    }))
                    .range([0, width]);
                svg.append("g")
                    .attr("transform", "translate(0," + height + ")")
                    .call(d3.axisBottom(x).ticks(10));

                // Add Y axis
                y = d3.scaleLinear()
                    .domain([d3.min(data, function (d) {
                        return +d.Value;
                    }) / 1.005,
                        d3.max(data, function (d) {
                            return +d.Value;
                        }) * 1.005])
                    .range([height, 0])
                svg.append("g")
                    .call(d3.axisLeft(y).ticks(5))
                    .append("text")
                    .attr("class", "axis-title")
                    .attr("transform", "rotate(-90)")
                    .attr("y", 6)
                    .attr("dy", ".71em")
                    .style("text-anchor", "end")
                    .attr("fill", "#5D6971")
                    .text("US$");

                var text = svg.append("text")
                    .attr("x", (width / 2))
                    .attr("y", 0 - (margin.top / 2))
                    .attr("text-anchor", "middle")
                    .style("font-size", "16px")
                    .style("text-decoration", "underline")
                    .attr("id", "lineChartTitle")
                    .text("Health expenditure per capital, " + selectedCountry);


                // Initialize line with first group of the list
                var line = svg
                    .append('g')
                    .append("path")
                    .datum(data.filter(function (d) {
                        return d.Country_Name == selectedCountry
                    }))
                    .attr("d", d3.line()
                        .x(function (d) {
                            return x(d.Year)
                        })
                        .y(function (d) {
                            return y(+d.Value)
                        })
                    )
                    .attr("id", "lineline")
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-width", 4)
                    .style("fill", "none");

                var focus = svg
                    .append('g')
                    .attr("class", "focus")
                    .style("display", "none");

                focus.append("line")
                    .attr("class", "x-hover-line hover-line")
                    .attr("y1", 0)
                    .attr("y2", height)
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-dasharray", 3);

                focus.append("line")
                    .attr("class", "y-hover-line hover-line")
                    .attr("x1", width)
                    .attr("x2", width)
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .style("stroke-dasharray", 3);

                focus.append("circle")
                    .attr("fill", function (d) {
                        return myColor("valueA")
                    })
                    .attr("stroke", function (d) {
                        return myColor("valueA")
                    })
                    .attr("r", 5);

                focus.append("text")
                    .attr("x", 5)
                    .attr("dy", ".31em");

                var rect = svg.append("rect")
                    .attr("transform", "translate(" + margin.top + ")")
                    .attr("class", "overlay")
                    .attr("width", width + 50)
                    .attr("height", height)
                    .on("mouseover", function () {
                        focus.style("display", null);
                    })
                    .on("mouseout", function () {
                        focus.style("display", "none");
                    })
                    .on("mousemove", mousemove);

                function mousemove() {
                    var filtered_data = data.filter(function (d) {
                        return d.Country_Name == selectedCountry
                    });
                    var x0 = x.invert(d3.mouse(this)[0])
                    i = bisectDate(filtered_data, x0, 1);
                    d0 = filtered_data[i - 1];
                    d1 = filtered_data[i];
                    if (typeof d1 !== 'undefined') {
                        d = x0 - d0.year > d1.year - x0 ? d1 : d0;

                    } else {
                        d = filtered_data[10]
                    }
                    focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Value) + ")");
                    focus.select("text").text(function () {
                        return d.Value;
                    });
                    focus.select(".x-hover-line").attr("y2", height - y(d.Value));
                    focus.select(".y-hover-line").attr("x2", width + width);

                }

            })


        }


        ////////////Bar charts////////////
        var Year_2008_aid = [
            {group: "Iraq", value: 9884530273},
            {group: "Afghanistan", value: 4811209961},
            {group: "Small states", value: 3736150010},
            {group: "Ethiopia", value: 3316250000},
            {group: "Sudan", value: 2566429932},
            {group: "West Bank and Gaza", value: 2470080078},
            {group: "Tanzania", value: 2331149902},
            {group: "Vietnam", value: 2320510010},
            {group: "India", value: 2011579956},
            {group: "Mozambique", value: 1993089966},
            {group: "Congo, Dem. Rep.", value: 1766900024},
            {group: "Bangladesh", value: 1765829956},
            {group: "Egypt, Arab Rep.", value: 1688530029},
            {group: "Uganda", value: 1643390015},
            {group: "Morocco", value: 1453359985},
            {group: "Kenya", value: 1363400024},
            {group: "Gibraltar", value: 1312170044},
            {group: "China", value: 1305540039},
            {group: "Nigeria", value: 1293719971},
            {group: "Liberia", value: 1250410034}];
        var Year_2009_aid = [
            {group: "Afghanistan", value: 6113120117},
            {group: "Ethiopia", value: 3823760010},
            {group: "Small states", value: 3597210009},
            {group: "Vietnam", value: 3328030029},
            {group: "Tanzania", value: 3127199951},
            {group: "West Bank and Gaza", value: 2827669922},
            {group: "Iraq", value: 2791229980},
            {group: "Pakistan", value: 2532870117},
            {group: "India", value: 2456610107},
            {group: "Cote d'Ivoire", value: 2403010010},
            {group: "Congo, Dem. Rep.", value: 2362350098},
            {group: "Sudan", value: 2352469971},
            {group: "Mozambique", value: 2013599976},
            {group: "Uganda", value: 1786349976},
            {group: "Kenya", value: 1782479980},
            {group: "Nigeria", value: 1639229980},
            {group: "Gibraltar", value: 1584680054},
            {group: "Turkey", value: 1356239990},
            {group: "Zambia", value: 1270819946},
            {group: "China", value: 1141390015}];
        var Year_2010_aid = [
            {group: "Afghanistan", value: 6235319824},
            {group: "Small states", value: 3957520000},
            {group: "Congo, Dem. Rep.", value: 3483649902},
            {group: "Ethiopia", value: 3455159912},
            {group: "Tanzania", value: 2960310059},
            {group: "Pakistan", value: 2933209961},
            {group: "Haiti", value: 2889840088},
            {group: "India", value: 2831340088},
            {group: "Vietnam", value: 2769860107},
            {group: "West Bank and Gaza", value: 2512560059},
            {group: "Iraq", value: 2178330078},
            {group: "Nigeria", value: 2052360107},
            {group: "Sudan", value: 2025849976},
            {group: "Mozambique", value: 1943130005},
            {group: "Gibraltar", value: 1697219971},
            {group: "Uganda", value: 1690140015},
            {group: "Kenya", value: 1631260010},
            {group: "Liberia", value: 1416109985},
            {group: "Bangladesh", value: 1327329956},
            {group: "Indonesia", value: 1323760010}];
        var Year_2011_aid = [
            {group: "Afghanistan", value: 6745740234},
            {group: "Congo, Dem. Rep.", value: 5526459961},
            {group: "Small states", value: 3845949979},
            {group: "Pakistan", value: 3714360107},
            {group: "Ethiopia", value: 3495889893},
            {group: "Vietnam", value: 3332000000},
            {group: "Turkey", value: 3288270020},
            {group: "India", value: 3270219971},
            {group: "Kenya", value: 2478820068},
            {group: "Tanzania", value: 2441830078},
            {group: "West Bank and Gaza", value: 2434739990},
            {group: "Mozambique", value: 2065469971},
            {group: "Iraq", value: 1914689941},
            {group: "Nigeria", value: 1809859985},
            {group: "Gibraltar", value: 1803869995},
            {group: "Sudan", value: 1742400024},
            {group: "Uganda", value: 1572920044},
            {group: "Haiti", value: 1506459961},
            {group: "Morocco", value: 1440239990},
            {group: "Cote d'Ivoire", value: 1437709961}];
        var Year_2012_aid = [
            {group: "Afghanistan", value: 6666770020},
            {group: "Vietnam", value: 4113310059},
            {group: "Small states", value: 3735980010},
            {group: "Ethiopia", value: 3243290039},
            {group: "Turkey", value: 3112169922},
            {group: "Cote d'Ivoire", value: 2908350098},
            {group: "Congo, Dem. Rep.", value: 2846169922},
            {group: "Tanzania", value: 2822229980},
            {group: "Kenya", value: 2653659912},
            {group: "Bangladesh", value: 2154050049},
            {group: "Mozambique", value: 2071699951},
            {group: "Pakistan", value: 2017410034},
            {group: "West Bank and Gaza", value: 2006109985},
            {group: "Nigeria", value: 1916170044},
            {group: "Egypt, Arab Rep.", value: 1813430054},
            {group: "Gibraltar", value: 1799290039},
            {group: "India", value: 1681849976},
            {group: "Syrian Arab Republic", value: 1671599976},
            {group: "Uganda", value: 1642500000},
            {group: "Morocco", value: 1471140015}];
        var Year_2013_aid = [
            {group: "Egypt, Arab Rep.", value: 5512509766},
            {group: "Afghanistan", value: 5152540039},
            {group: "Vietnam", value: 4085600098},
            {group: "Myanmar", value: 3936120117},
            {group: "Ethiopia", value: 3885540039},
            {group: "Small states", value: 3766680027},
            {group: "Syrian Arab Republic", value: 3637929932},
            {group: "Tanzania", value: 3433239990},
            {group: "Kenya", value: 3306840088},
            {group: "Turkey", value: 2847840088},
            {group: "Bangladesh", value: 2633590088},
            {group: "West Bank and Gaza", value: 2602330078},
            {group: "Congo, Dem. Rep.", value: 2584010010},
            {group: "Nigeria", value: 2515719971},
            {group: "India", value: 2456340088},
            {group: "Mozambique", value: 2312699951},
            {group: "Pakistan", value: 2194469971},
            {group: "Morocco", value: 2008650024},
            {group: "Uganda", value: 1697089966},
            {group: "Iraq", value: 1541540039}];
        var Year_2014_aid = [
            {group: "Afghanistan", value: 4942970215},
            {group: "Vietnam", value: 4215620117},
            {group: "Syrian Arab Republic", value: 4174310059},
            {group: "Pakistan", value: 3615820068},
            {group: "Ethiopia", value: 3583959961},
            {group: "Egypt, Arab Rep.", value: 3537600098},
            {group: "Turkey", value: 3446770020},
            {group: "Small states", value: 3213590000},
            {group: "India", value: 2991820068},
            {group: "Jordan", value: 2697159912},
            {group: "Kenya", value: 2661030029},
            {group: "Tanzania", value: 2650520020},
            {group: "West Bank and Gaza", value: 2487840088},
            {group: "Nigeria", value: 2478600098},
            {group: "Bangladesh", value: 2422639893},
            {group: "Congo, Dem. Rep.", value: 2400020020},
            {group: "Morocco", value: 2240149902},
            {group: "Mozambique", value: 2106010010},
            {group: "South Sudan", value: 1964119995},
            {group: "Uganda", value: 1633680054}];
        var Year_2015_aid = [
            {group: "Syrian Arab Republic", value: 4920470215},
            {group: "Afghanistan", value: 4274229980},
            {group: "Pakistan", value: 3764020020},
            {group: "Ethiopia", value: 3238889893},
            {group: "India", value: 3174350098},
            {group: "Vietnam", value: 3167389893},
            {group: "Small states", value: 2801819993},
            {group: "Congo, Dem. Rep.", value: 2599040039},
            {group: "Bangladesh", value: 2592909912},
            {group: "Tanzania", value: 2584709961},
            {group: "Egypt, Arab Rep.", value: 2524530029},
            {group: "Kenya", value: 2463520020},
            {group: "Nigeria", value: 2431540039},
            {group: "Turkey", value: 2141260010},
            {group: "Jordan", value: 2141050049},
            {group: "West Bank and Gaza", value: 1872209961},
            {group: "Mozambique", value: 1819119995},
            {group: "Yemen, Rep.", value: 1778410034},
            {group: "Gibraltar", value: 1770479980},
            {group: "South Sudan", value: 1674829956}];
        var Year_2016_aid = [
            {group: "Syrian Arab Republic", value: 8899750000},
            {group: "Ethiopia", value: 4084250000},
            {group: "Afghanistan", value: 4069419922},
            {group: "Turkey", value: 3609090088},
            {group: "Pakistan", value: 2960939941},
            {group: "Vietnam", value: 2906070068},
            {group: "Jordan", value: 2727969971},
            {group: "Cuba", value: 2698110107},
            {group: "India", value: 2678889893},
            {group: "Small states", value: 2662560021},
            {group: "Bangladesh", value: 2532669922},
            {group: "Nigeria", value: 2498189941},
            {group: "Egypt, Arab Rep.", value: 2437350098},
            {group: "West Bank and Gaza", value: 2401659912},
            {group: "Tanzania", value: 2317889893},
            {group: "Yemen, Rep.", value: 2301110107},
            {group: "Iraq", value: 2287899902},
            {group: "Kenya", value: 2188389893},
            {group: "Congo, Dem. Rep.", value: 2102209961},
            {group: "Morocco", value: 2062310059}];
        var Year_2017_aid = [
            {group: "Syrian Arab Republic", value: 10427849609},
            {group: "Ethiopia", value: 4124270020},
            {group: "Afghanistan", value: 3811739990},
            {group: "Bangladesh", value: 3781679932},
            {group: "Nigeria", value: 3358959961},
            {group: "Yemen, Rep.", value: 3234010010},
            {group: "Small states", value: 3232580027},
            {group: "India", value: 3198389893},
            {group: "Turkey", value: 3147209961},
            {group: "Jordan", value: 2978790039},
            {group: "Iraq", value: 2907510010},
            {group: "Tanzania", value: 2585439941},
            {group: "Kenya", value: 2480219971},
            {group: "Morocco", value: 2416270020},
            {group: "Vietnam", value: 2404000000},
            {group: "Pakistan", value: 2364179932},
            {group: "Congo, Dem. Rep.", value: 2292639893},
            {group: "South Sudan", value: 2183239990},
            {group: "West Bank and Gaza", value: 2147179932},
            {group: "Uganda", value: 2009199951}];
        var Year_2018_aid = [
            {group: "Syrian Arab Republic", value: 9990820313},
            {group: "Yemen, Rep.", value: 7985220215},
            {group: "Ethiopia", value: 4930049805},
            {group: "Afghanistan", value: 3788889893},
            {group: "Small states", value: 3385910016},
            {group: "Nigeria", value: 3301520020},
            {group: "Bangladesh", value: 3040219971},
            {group: "Jordan", value: 2523949951},
            {group: "Congo, Dem. Rep.", value: 2509780029},
            {group: "Kenya", value: 2488389893},
            {group: "India", value: 2453979980},
            {group: "Tanzania", value: 2453260010},
            {group: "Iraq", value: 2299870117},
            {group: "West Bank and Gaza", value: 2240409912},
            {group: "Egypt, Arab Rep.", value: 2063739990},
            {group: "Uganda", value: 1940800049},
            {group: "Mozambique", value: 1819790039},
            {group: "Colombia", value: 1762689941},
            {group: "Myanmar", value: 1687670044},
            {group: "Vietnam", value: 1633349976}];

        var Year_2008_spending = [
            {group: "Norway", value: 7768.050293},
            {group: "Luxembourg", value: 7578.749512},
            {group: "United States", value: 7410.700684},
            {group: "Switzerland", value: 7120.651855},
            {group: "North America", value: 7119.878114},
            {group: "Denmark", value: 6137.776367},
            {group: "Ireland", value: 5638.779297},
            {group: "Netherlands", value: 5382.445801},
            {group: "Austria", value: 5057.760742},
            {group: "Iceland", value: 4946.0625},
            {group: "France", value: 4812.536621},
            {group: "Belgium", value: 4671.56543},
            {group: "Germany", value: 4669.635254},
            {group: "Sweden", value: 4626.638672},
            {group: "Finland", value: 4481.216797},
            {group: "Canada", value: 4459.876465},
            {group: "United Kingdom", value: 4351.276855},
            {group: "San Marino", value: 4301.019531},
            {group: "Australia", value: 4090.761963},
            {group: "Monaco", value: 3573.521484}];
        var Year_2009_spending = [
            {group: "United States", value: 7681.247559},
            {group: "Luxembourg", value: 7670.59375},
            {group: "North America", value: 7352.86105},
            {group: "Norway", value: 7301.959961},
            {group: "Switzerland", value: 7297.379883},
            {group: "Denmark", value: 6221.688965},
            {group: "Ireland", value: 5502.887695},
            {group: "Netherlands", value: 5282.743164},
            {group: "Austria", value: 4928.987793},
            {group: "France", value: 4741.415527},
            {group: "Germany", value: 4674.783203},
            {group: "Belgium", value: 4653.915039},
            {group: "Canada", value: 4357.233887},
            {group: "Finland", value: 4347.121582},
            {group: "San Marino", value: 4209.331543},
            {group: "Sweden", value: 4137.5},
            {group: "Australia", value: 3995.340088},
            {group: "United Kingdom", value: 3892.01416},
            {group: "Iceland", value: 3693.556885},
            {group: "Japan", value: 3686.154297}];
        var Year_2010_spending = [
            {group: "United States", value: 7930.151367},
            {group: "Norway", value: 7859.516113},
            {group: "Switzerland", value: 7705.175781},
            {group: "North America", value: 7644.718372},
            {group: "Luxembourg", value: 7459.835449},
            {group: "Denmark", value: 6011.538086},
            {group: "Netherlands", value: 5191.693848},
            {group: "Ireland", value: 5133.455078},
            {group: "Canada", value: 5048.309082},
            {group: "Australia", value: 4945.038086},
            {group: "Austria", value: 4800.793457},
            {group: "Germany", value: 4611.810547},
            {group: "France", value: 4598.320313},
            {group: "Belgium", value: 4544.996094},
            {group: "Sweden", value: 4420.259766},
            {group: "Finland", value: 4249.602051},
            {group: "Japan", value: 4060.490967},
            {group: "San Marino", value: 3991.243896},
            {group: "United Kingdom", value: 3955.451416},
            {group: "Iceland", value: 3644.802734}];
        var Year_2011_spending = [
            {group: "Switzerland", value: 9191.958984},
            {group: "Norway", value: 8900.37207},
            {group: "United States", value: 8130.756348},
            {group: "North America", value: 7855.256401},
            {group: "Luxembourg", value: 7174.739258},
            {group: "Sweden", value: 6354.291992},
            {group: "Denmark", value: 6281.004395},
            {group: "Australia", value: 5861.702637},
            {group: "Ireland", value: 5570.705566},
            {group: "Netherlands", value: 5562.121094},
            {group: "Canada", value: 5355.67627},
            {group: "Austria", value: 5167.817871},
            {group: "Japan", value: 5087.356445},
            {group: "Germany", value: 5036.484863},
            {group: "Belgium", value: 4943.832031},
            {group: "France", value: 4939.310547},
            {group: "Finland", value: 4715.935059},
            {group: "San Marino", value: 4248.477051},
            {group: "United Kingdom", value: 4208.419922},
            {group: "Iceland", value: 3866.707275}];
        var Year_2012_spending = [
            {group: "Norway", value: 8970.120117},
            {group: "Switzerland", value: 8917.119141},
            {group: "United States", value: 8399.239258},
            {group: "North America", value: 8106.494422},
            {group: "Sweden", value: 6254.64502},
            {group: "Luxembourg", value: 6029.475098},
            {group: "Australia", value: 6025.344727},
            {group: "Denmark", value: 6003.830566},
            {group: "Canada", value: 5459.959473},
            {group: "Netherlands", value: 5284.649902},
            {group: "Ireland", value: 5239.337891},
            {group: "Japan", value: 5212.183594},
            {group: "Austria", value: 4966.095703},
            {group: "Germany", value: 4762.847656},
            {group: "Belgium", value: 4706.618164},
            {group: "France", value: 4651.108398},
            {group: "Finland", value: 4572.523438},
            {group: "United Kingdom", value: 4282.048828},
            {group: "San Marino", value: 3984.977539},
            {group: "New Zealand", value: 3805.97168}];
        var Year_2013_spending = [
            {group: "Switzerland", value: 9275.798828},
            {group: "Norway", value: 9241.265625},
            {group: "United States", value: 8599.527344},
            {group: "North America", value: 8280.777949},
            {group: "Sweden", value: 6696.117188},
            {group: "Luxembourg", value: 6356.644531},
            {group: "Denmark", value: 6236.554199},
            {group: "Australia", value: 5813.985352},
            {group: "Netherlands", value: 5532.726563},
            {group: "Canada", value: 5409.788086},
            {group: "Ireland", value: 5331.600586},
            {group: "Austria", value: 5235.341309},
            {group: "Germany", value: 5096.820801},
            {group: "Belgium", value: 4947.864746},
            {group: "France", value: 4901.933105},
            {group: "Finland", value: 4892.097168},
            {group: "United Kingdom", value: 4350.255371},
            {group: "Japan", value: 4336.106934},
            {group: "Iceland", value: 4028.831543},
            {group: "San Marino", value: 3993.264404}];
        var Year_2014_spending = [
            {group: "Switzerland", value: 9578.645508},
            {group: "Norway", value: 9118.317383},
            {group: "United States", value: 9023.611328},
            {group: "North America", value: 8639.543671},
            {group: "Sweden", value: 6605.987305},
            {group: "Luxembourg", value: 6547.034668},
            {group: "Denmark", value: 6380.784668},
            {group: "Australia", value: 5607.917969},
            {group: "Netherlands", value: 5601.885742},
            {group: "Ireland", value: 5399.598633},
            {group: "Austria", value: 5393.602051},
            {group: "Germany", value: 5304.318848},
            {group: "Canada", value: 5189.82666},
            {group: "Belgium", value: 4999.188477},
            {group: "France", value: 4998.668457},
            {group: "Finland", value: 4922.675781},
            {group: "United Kingdom", value: 4740.868652},
            {group: "Iceland", value: 4474.374023},
            {group: "New Zealand", value: 4143.788086},
            {group: "Japan", value: 4099.280273}];
        var Year_2015_spending = [
            {group: "United States", value: 9491.09082},
            {group: "Switzerland", value: 9382.791016},
            {group: "North America", value: 9002.600503},
            {group: "Norway", value: 7565.549805},
            {group: "Sweden", value: 5595.033203},
            {group: "Denmark", value: 5469.334961},
            {group: "Luxembourg", value: 5421.932129},
            {group: "Australia", value: 4860.37207},
            {group: "Netherlands", value: 4676.57666},
            {group: "Germany", value: 4622.206543},
            {group: "Canada", value: 4615.64209},
            {group: "Austria", value: 4612.824219},
            {group: "Ireland", value: 4561.737793},
            {group: "United Kingdom", value: 4472.521484},
            {group: "Belgium", value: 4290},
            {group: "Iceland", value: 4281.575684},
            {group: "France", value: 4208.38623},
            {group: "Finland", value: 4127.149902},
            {group: "Japan", value: 3733.376465},
            {group: "New Zealand", value: 3582.272949}];
        var Year_2016_spending = [
            {group: "United States", value: 9877.871094},
            {group: "Switzerland", value: 9439.424805},
            {group: "North America", value: 9348.178146},
            {group: "Norway", value: 7496.768555},
            {group: "Sweden", value: 5674.477539},
            {group: "Denmark", value: 5565.593262},
            {group: "Luxembourg", value: 5475.139648},
            {group: "Iceland", value: 5067.690918},
            {group: "Australia", value: 4971.614746},
            {group: "Germany", value: 4742.03418},
            {group: "Netherlands", value: 4734.833496},
            {group: "Ireland", value: 4717.568359},
            {group: "Austria", value: 4709.875977},
            {group: "Canada", value: 4610.92627},
            {group: "Belgium", value: 4328.846191},
            {group: "France", value: 4268.174316},
            {group: "Japan", value: 4174.422363},
            {group: "Finland", value: 4107.062988},
            {group: "United Kingdom", value: 4066.093506},
            {group: "New Zealand", value: 3746.476807}];
        var Year_2017_spending = [
            {group: "United States", value: 10209.63086},
            {group: "North America", value: 9667.433833},
            {group: "Switzerland", value: 9606.349609},
            {group: "Norway", value: 7815.786621},
            {group: "Iceland", value: 6109.912109},
            {group: "Sweden", value: 5838.215332},
            {group: "Denmark", value: 5800.152832},
            {group: "Luxembourg", value: 5713.118652},
            {group: "Australia", value: 5308.783203},
            {group: "Germany", value: 5052.67334},
            {group: "Ireland", value: 5019.701172},
            {group: "Austria", value: 4937.977051},
            {group: "Netherlands", value: 4910.899414},
            {group: "Canada", value: 4845.589844},
            {group: "Belgium", value: 4618.208984},
            {group: "France", value: 4424.507813},
            {group: "Finland", value: 4233.468262},
            {group: "Japan", value: 4121.036621},
            {group: "United Kingdom", value: 3978.617188},
            {group: "New Zealand", value: 3940.390381}];
        var Year_2018_spending = [
            {group: "United States", value: 10623.84961},
            {group: "North America", value: 10050.38179},
            {group: "Switzerland", value: 9870.664063},
            {group: "Norway", value: 8239.095703},
            {group: "Iceland", value: 6530.932129},
            {group: "Luxembourg", value: 6227.083984},
            {group: "Denmark", value: 6216.768555},
            {group: "Sweden", value: 5981.706055},
            {group: "Ireland", value: 5489.070801},
            {group: "Germany", value: 5472.202148},
            {group: "Australia", value: 5425.340332},
            {group: "Austria", value: 5326.437012},
            {group: "Netherlands", value: 5306.534668},
            {group: "Canada", value: 4994.902344},
            {group: "Belgium", value: 4912.700684},
            {group: "France", value: 4690.072266},
            {group: "Finland", value: 4515.677246},
            {group: "United Kingdom", value: 4315.427734},
            {group: "Japan", value: 4266.586914},
            {group: "New Zealand", value: 4037.462891}];
        var margin = {top: 30, right: 30, bottom: 70, left: 130},
            width = 460 - margin.left - margin.right,
            height = 400 - margin.top - margin.bottom;

        var svg_bar1 = d3.select("#Barchart_received")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");
        var svg_bar2 = d3.select("#Barchart_spend")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform",
                "translate(" + margin.left + "," + margin.top + ")");


        var bar_x = d3.scaleLinear()
            .domain([0, 10000000000])
            .range([0, width])
        svg_bar1.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(bar_x))
            .selectAll("text")
            .attr("transform", "translate(-10,0)rotate(-45)")
            .style("text-anchor", "end");


        var bar_x2 = d3.scaleLinear()
            .domain([0, 12000])
            .range([0, width])
        svg_bar2.append("g")
            .attr("transform", "translate(0," + height + ")")
            .call(d3.axisBottom(bar_x2))
            .selectAll("text")
            .attr("transform", "translate(-10,0)rotate(-45)")
            .style("text-anchor", "end");

        var bar_y = d3.scaleBand()
            .range([0, height])
            .domain(Year_2008_aid.map(function (d) {
                return d.group;
            }))
            .padding(.1);
        svg_bar1.append("g")
            .attr("class", "myYaxis")
            .call(d3.axisLeft(bar_y))
        // svg_bar2.append("g")
        //   .attr("class", "myYaxis2")
        //   .call(d3.axisLeft(bar_y))


        var allGroup = ["2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018"]

        d3.select("#selectButton")
            .selectAll('myOptions')
            .data(allGroup)
            .enter()
            .append('option')
            .text(function (d) {
                return d;
            }) // text showed in the menu
            .attr("value", function (d) {
                return d;
            }) // value

        function updateBarChart1(data) {



            bar_y
                .range([0, height])
                .domain(data.map(function (d) {
                    return d.group;
                }))
                .padding(.1);

            svg_bar1.append("g")
                .attr("class", "myYaxis")
                .call(d3.axisLeft(bar_y))


            var u = svg_bar1.selectAll("rect")
                .data(data)
            u
                .enter()
                .append("rect")
                .merge(u)
                .transition()
                .duration(1000)
                .attr("x", bar_x(0))
                .attr("y", function (d) {
                    return bar_y(d.group);
                })
                .attr("width", function (d) {
                    return bar_x(d.value);
                })
                .attr("height", bar_y.bandwidth())
                .attr("fill", "#CC5959")

        }


        function updateBarChart2(data) {



            bar_y
                .range([0, height])
                .domain(data.map(function (d) {
                    return d.group;
                }))
                .padding(.1);

            svg_bar2.append("g")
                .attr("class", "myYaxis")
                .call(d3.axisLeft(bar_y))


            var u2 = svg_bar2.selectAll("rect")
                .data(data)
            u2
                .enter()
                .append("rect")
                .merge(u2)
                .transition()
                .duration(1000)
                .attr("x", bar_x2(0))
                .attr("y", function (d) {
                    return bar_y(d.group);
                })
                .attr("width", function (d) {
                    return bar_x2(d.value);
                })
                .attr("height", bar_y.bandwidth())
                .attr("fill", "#FFE137")

        }


        d3.select("#selectButton").on("change", function (d) {
            var selectedOption = d3.select(this).property("value");
            if (selectedOption == "2008") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2008_aid);
                updateBarChart2(Year_2008_spending);

            } else if (selectedOption == "2009") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2009_aid);
                updateBarChart2(Year_2009_spending);
            } else if (selectedOption == "2010") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2010_aid);
                updateBarChart2(Year_2010_spending);
            } else if (selectedOption == "2011") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2011_aid);
                updateBarChart2(Year_2011_spending);
            } else if (selectedOption == "2012") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2012_aid);
                updateBarChart2(Year_2012_spending);
            } else if (selectedOption == "2013") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2013_aid);
                updateBarChart2(Year_2013_spending);
            } else if (selectedOption == "2014") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2014_aid);
                updateBarChart2(Year_2014_spending);
            } else if (selectedOption == "2015") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2015_aid);
                updateBarChart2(Year_2015_spending);
            } else if (selectedOption == "2016") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2016_aid);
                updateBarChart2(Year_2016_spending);
            } else if (selectedOption == "2017") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2017_aid);
                updateBarChart2(Year_2017_spending);
            } else if (selectedOption == "2018") {
                svg_bar1.selectAll(".myYaxis").remove();
                svg_bar2.selectAll(".myYaxis").remove();
                updateBarChart1(Year_2018_aid);
                updateBarChart2(Year_2018_spending);
            }
            // run the updateChart function with this selected option
            //update(selectedOption)
        })

        updateBarChart1(Year_2008_aid)
        updateBarChart2(Year_2008_spending)

    }

    function country_line_plot(xData, yData, title, divId, label_terminator) {
        const lastDataIndex = xData[0].length - 1;

        let markerSize = Array(xData[0].length).fill(10)
        markerSize[0] = 20
        markerSize[lastDataIndex] = 20

        const colors = ['rgba(255, 113, 206, 1)', 'rgba(82, 191, 144, 1)', 'rgba(136, 118, 236, 1)', 'rgba(148, 223, 243, 1)', 'rgba(59, 89, 152, 1)',];

        const lineSize = [4, 4, 4, 4, 4];

        const labels = plotly_country_selection;

        const data = [];
        let i = 0;
        for (i = 0; i < xData.length; i++) {
            const lineMark = {
                x: xData[i],
                y: yData[i],
                type: 'scatter',
                mode: 'lines + markers',
                line: {
                    color: colors[i],
                    width: lineSize[i]
                },
                marker: {
                    color: colors[i],
                    size: markerSize
                },
                name: labels[i],
                hoverInfo: "x",
            }
            data.push(lineMark);
        }

        const layout = {
            showlegend: false,
            height: 700,
            width: 1000,
            xaxis: {
                showline: true,
                showgrid: false,
                showticklabels: true,
                linecolor: 'rgb(204,204,204)',
                linewidth: 2,
                autotick: false,
                ticks: 'outside',
                tickcolor: 'rgb(204,204,204)',
                tickwidth: 2,
                ticklen: 5,
                tickfont: {
                    family: 'Arial',
                    size: 12,
                    color: 'rgb(82, 82, 82)'
                }
            },
            yaxis: {
                showgrid: false,
                zeroline: false,
                showline: false,
                showticklabels: false
            },
            autosize: true,
            margin: {
                autoexpand: true,
                l: 100,
                r: 20,
                t: 100
            },
            annotations: [
                {
                    xref: 'paper',
                    yref: 'paper',
                    x: 0.25,
                    y: 1.05,
                    xanchor: 'left',
                    yanchor: 'center',
                    text: title,
                    font: {
                        family: 'Arial',
                        size: 30,
                        color: 'rgb(37,37,37)'
                    },
                    showarrow: false
                }
            ]
        };

        for (i = 0; i < xData.length; i++) {
            let yLeft = 0
            for (let j = 0; j < yData[i].length; j++) {
                let elem = yData[i][j]
                if (!isNaN(elem)) {
                    yLeft = j;
                    break;
                }
            }
            let yRight = lastDataIndex;
            for (let j = lastDataIndex; j > -1; j--) {
                let elem = yData[i][j]
                if (!isNaN(elem)) {
                    yRight = j;
                    break;
                }
            }
            const leftMargin = {
                xref: 'paper',
                x: 0.05 + 0.05 * (yLeft),
                y: yData[i][yLeft],
                xanchor: 'right',
                yanchor: 'middle',
                text: labels[i] + ' ' + yData[i][yLeft] + label_terminator,
                showarrow: false,
                font: {
                    family: 'Arial',
                    size: 16,
                    color: 'black'
                }
            };
            const rightMargin = {
                xref: 'paper',
                x: 0.95 - 0.05 * (lastDataIndex - yRight),
                y: yData[i][yRight],
                xanchor: 'left',
                yanchor: 'middle',
                text: yData[i][yRight] + label_terminator,
                font: {
                    family: 'Arial',
                    size: 16,
                    color: 'black'
                },
                showarrow: false
            };

            layout.annotations.push(leftMargin, rightMargin);
        }
        Plotly.newPlot(divId, data, layout, {displaylogo: false, displayModeBar: false});
    }

    function q3_gdp_plot() {
        const gdpData = plotly_country_selection.map(x => q3_data.get(x))
        let xData = [];
        for (let i = 0; i < plotly_country_selection.length; i++) {
            xData.push(q3_q4_years);
        }
        country_line_plot(xData, gdpData, 'Health Expenditure (% of GDP)', 'gdpDiv', '%');
    }

    function q4_oop_plot() {
        const oopData = plotly_country_selection.map(x => q4_data.get(x))
        let xData = [];
        for (let i = 0; i < plotly_country_selection.length; i++) {
            xData.push(q3_q4_years);
        }
        country_line_plot(xData, oopData, 'Out of Pocket Medical Expense (USD)', 'oopDiv', '$');
    }
</script>
<script src="./assets/num_beds.js"></script>
<script src="./assets/life_expectancy.js"></script>
</body>
</html>