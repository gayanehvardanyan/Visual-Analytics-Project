<html><head>    
  <title>Map</title></head>

<!-- Code from d3-graph-gallery.com -->
<!DOCTYPE html>
<meta charset="utf-8">

<style>
body { font: 12px Arial;}

.overlay {
  fill: none;
  pointer-events: all;
}
#map{
  float: left;
  width: 45%;
  border: 1px solid black;
  border-radius: 5px;
  margin-left: 30px;
  margin-top: 20px;
  
  
}
#line{
  float: left;
  width: 50%;
  margin-left: 30px;
  margin-top: 10px;
 
 
  
}
#line2{
  float: left;
  width: 50%;
  margin-left: 30px;
  margin-top: 20px;
 
 
  
}
.container {
   width: 100%;
   height: 100%;
} 

</style>

<!-- Load d3.js -->
<script src="http://d3js.org/d3.v4.js"></script>
<script src="https://d3js.org/d3-scale-chromatic.v1.min.js"></script>
<script src="https://d3js.org/d3-geo-projection.v2.min.js"></script>
<h1>If the financial aid the government received contributes to people's health?</h1>
<p>Click the country on the map to compare the received financial aid and the Health expenditure per capital from 2008 to 2018. Hover the line chart can see the amount for each year.</p>
<div class="container">
<svg id="map" width="800" height="400"></svg>
<svg id="line" width="550" height="200"></svg>
<svg id="line2" width="550" height="200"></svg>


</div>

<script> 
////Map////////Map////////Map////////Map////////Map////////Map////////Map//// 
var svg = d3.select("#map"),
  width = +svg.attr("width"),
  height = +svg.attr("height");

// Map and projection
var path = d3.geoPath();
var projection = d3.geoMercator()
  .scale(100)
  .center([135,17])
  //.translate([width / 2, height / 2]);

//Data and color scale
var data = d3.map();
var colorScale = d3.scaleThreshold()
  .domain([0, 3, 6, 9, 12, 15,18])
  .range(d3.schemeBlues[8]);

d3.queue()
  .defer(d3.json, "https://raw.githubusercontent.com/YuhsuanChen/dataset/main/geo.json")
  .defer(d3.csv, "https://raw.githubusercontent.com/YuhsuanChen/dataset/main/death_rate.csv", function(d) { data.set(d.Country_Code, [d.Country_Name,+d.years_sum]); })
  .await(mapChart);
  console.log

function mapChart(error, topo) {

  //Draw the map
  svg.append("g")
    .selectAll("path")
    .data(topo.features)
    .enter()
    .append("path")
      // draw each country
      .attr("d", d3.geoPath()
        .projection(projection)
      )
      // set the color of each country

      .attr("fill", function (d) {
        d.value = data.get(d.id)
        if(typeof d.value !== 'undefined'){
            //console.log(d.value[1])
          d.total = d.value[1] || 0;
        }else{
          d.total =0
        }
         return colorScale(d.total);
        
      })
      .style("stroke", "transparent")
      .attr("class", function(d){ return "Country_Code" } )
      .style("opacity", .8)
      .on("mouseover", mouseOver )
      .on("mouseleave", mouseLeave )
      .on("click", up)
    }
  
  var mouseOver = function(d) {
    

    d3.select(this)
      .transition()
      .style("opacity", 1)
      .style("stroke", "black")

    var text = svg.append("text")
    .attr("x", (width / 2)+10)             
    .attr("y", (height-10))
    .attr("text-anchor", "middle")  
    .style("font-size", "11px") 
    .attr("id", "mapTitle")
    .text(data.get(d.id)[0]+", death rate: "+data.get(d.id)[1]+" per 1000 people");
  }

  var mouseLeave = function(d) {
    d3.selectAll(".Country_Code")
      .transition()
      .style("opacity", .8)
      .style("stroke", "transparent")
    mapTitle.remove()
  
  }

  function up(d, i) {
    var selectedCountry=data.get(d.id)[0];
      d3.selectAll("#lineline").remove();
      d3.selectAll("#lineChartTitle").remove();
      createLine_received(selectedCountry);
      createLine_spend(selectedCountry);
  }
  

function createLine_received(selectedCountry){

// set the dimensions and margins of the graph
var margin = {top: 30, right: 80, bottom: 30, left: 90},
    width = 600 - margin.left - margin.right,
    height = 200 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#line")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleTime().range([0, width]);
var y = d3.scaleLinear().range([height, 0]);
var bisectDate = d3.bisector(function(d) { return d.Year; }).left;


//Read the data
d3.csv("https://raw.githubusercontent.com/YuhsuanChen/dataset/main/linechart_year_updated.csv", function(data) {
  
    var parseTime = d3.timeParse("%Y")
   
    var myColor = d3.scaleOrdinal()
      //.domain(allGroup)
      .range(d3.schemeSet2);

    // Add X axis --> it is a date format
    x = d3.scaleLinear()
      .domain(d3.extent(data, function(d) { return d.Year; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).ticks(10));

    // Add Y axis
    y = d3.scaleLinear()
      .domain([d3.min(data, function(d) { return +d.Value; })/ 1.005, 
               d3.max(data, function(d) { return +d.Value; })* 1.005])
      .range([ height, 0 ])
    svg.append("g")
      .call(d3.axisLeft(y).ticks(5))
      .append("text")
        .attr("class", "axis-title")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .attr("fill", "#5D6971")
              .text("US$");

    var text = svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-decoration", "underline")  
        .attr("id", "lineChartTitle")
        .text("Financial aid received, "+selectedCountry);
  
    
    // Initialize line with first group of the list
    var line = svg
      .append('g')
      .append("path")
        .datum(data.filter(function(d){return d.Country_Name ==selectedCountry}))
        .attr("d", d3.line()
          .x(function(d) { return x(d.Year) })
          .y(function(d) { return y(+d.Value) })
        )
        .attr("id", "lineline")
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-width", 4)
        .style("fill", "none");
    
    var focus = svg
        .append('g')
        .attr("class", "focus")
        .style("display", "none");
  
    focus.append("line")
        .attr("class", "x-hover-line hover-line")
        .attr("y1", 0)
        .attr("y2", height)
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-dasharray", 3);

    focus.append("line")
        .attr("class", "y-hover-line hover-line")
        .attr("x1", width)
        .attr("x2", width)
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-dasharray", 3);

    focus.append("circle")
        .attr("fill", function(d){ return myColor("valueA") })
        .attr("stroke", function(d){ return myColor("valueA") })
        .attr("r", 5);

    focus.append("text")
        .attr("x", 5)
        .attr("dy", ".31em");
  
    var rect =svg.append("rect")
          .attr("transform", "translate(" +margin.top + ")")
          .attr("class", "overlay")
          .attr("width", width+50)
          .attr("height", height)
          .on("mouseover", function() { focus.style("display", null); })
          .on("mouseout", function() { focus.style("display", "none"); })
          .on("mousemove",mousemove);

    function mousemove() {
              var filtered_data=data.filter(function(d){return d.Country_Name ==selectedCountry});
              var x0 = x.invert(d3.mouse(this)[0])
                  i = bisectDate(filtered_data, x0, 1);
                  d0 = filtered_data[i - 1];
                  d1 = filtered_data[i];
                  if(typeof d1 !== 'undefined'){
                  d = x0 - d0.year > d1.year - x0 ? d1 : d0;
             
                  }else{
                    d=filtered_data[10]
                  }
              focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Value) + ")");
              focus.select("text").text(function() { return d.Value;});
              focus.select(".x-hover-line").attr("y2", height - y(d.Value));
              focus.select(".y-hover-line").attr("x2", width + width);
            
            }
  
})




}
  
function createLine_spend(selectedCountry){

// set the dimensions and margins of the graph
var margin = {top: 30, right: 80, bottom: 30, left: 90},
    width = 600 - margin.left - margin.right,
    height = 200 - margin.top - margin.bottom;

// append the svg object to the body of the page
var svg = d3.select("#line2")
  .append("svg")
    .attr("width", width + margin.left + margin.right)
    .attr("height", height + margin.top + margin.bottom)
  .append("g")
    .attr("transform",
          "translate(" + margin.left + "," + margin.top + ")");

var x = d3.scaleTime().range([0, width]);
var y = d3.scaleLinear().range([height, 0]);
var bisectDate = d3.bisector(function(d) { return d.Year; }).left;


//Read the data
d3.csv("https://raw.githubusercontent.com/YuhsuanChen/dataset/main/linechart_spending.csv", function(data) {
    // List of groups (here I have one group per column)
    // var allGroup = d3.map(data, function(d){return(d.Country_Name)}).keys()

    var parseTime = d3.timeParse("%Y")
   
    var myColor = d3.scaleOrdinal()
      //.domain(allGroup)
      .range(d3.schemeSet2);

    // Add X axis --> it is a date format
    x = d3.scaleLinear()
      .domain(d3.extent(data, function(d) { return d.Year; }))
      .range([ 0, width ]);
    svg.append("g")
      .attr("transform", "translate(0," + height + ")")
      .call(d3.axisBottom(x).ticks(10));

    // Add Y axis
    y = d3.scaleLinear()
      .domain([d3.min(data, function(d) { return +d.Value; })/ 1.005, 
               d3.max(data, function(d) { return +d.Value; })* 1.005])
      .range([ height, 0 ])
    svg.append("g")
      .call(d3.axisLeft(y).ticks(5))
      .append("text")
        .attr("class", "axis-title")
              .attr("transform", "rotate(-90)")
              .attr("y", 6)
              .attr("dy", ".71em")
              .style("text-anchor", "end")
              .attr("fill", "#5D6971")
              .text("US$");

    var text = svg.append("text")
        .attr("x", (width / 2))             
        .attr("y", 0 - (margin.top / 2))
        .attr("text-anchor", "middle")  
        .style("font-size", "16px") 
        .style("text-decoration", "underline")  
        .attr("id", "lineChartTitle")
        .text("Health expenditure per capital, "+selectedCountry);
  
    
    // Initialize line with first group of the list
    var line = svg
      .append('g')
      .append("path")
        .datum(data.filter(function(d){return d.Country_Name ==selectedCountry}))
        .attr("d", d3.line()
          .x(function(d) { return x(d.Year) })
          .y(function(d) { return y(+d.Value) })
        )
        .attr("id", "lineline")
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-width", 4)
        .style("fill", "none");
    
    var focus = svg
        .append('g')
        .attr("class", "focus")
        .style("display", "none");
  
    focus.append("line")
        .attr("class", "x-hover-line hover-line")
        .attr("y1", 0)
        .attr("y2", height)
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-dasharray", 3);

    focus.append("line")
        .attr("class", "y-hover-line hover-line")
        .attr("x1", width)
        .attr("x2", width)
        .attr("stroke", function(d){ return myColor("valueA") })
        .style("stroke-dasharray", 3);

    focus.append("circle")
        .attr("fill", function(d){ return myColor("valueA") })
        .attr("stroke", function(d){ return myColor("valueA") })
        .attr("r", 5);

    focus.append("text")
        .attr("x", 5)
        .attr("dy", ".31em");
  
    var rect =svg.append("rect")
          .attr("transform", "translate(" +margin.top + ")")
          .attr("class", "overlay")
          .attr("width", width+50)
          .attr("height", height)
          .on("mouseover", function() { focus.style("display", null); })
          .on("mouseout", function() { focus.style("display", "none"); })
          .on("mousemove",mousemove);

    function mousemove() {
              var filtered_data=data.filter(function(d){return d.Country_Name ==selectedCountry});
              var x0 = x.invert(d3.mouse(this)[0])
                  i = bisectDate(filtered_data, x0, 1);
                  d0 = filtered_data[i - 1];
                  d1 = filtered_data[i];
                  if(typeof d1 !== 'undefined'){
                  d = x0 - d0.year > d1.year - x0 ? d1 : d0;
             
                  }else{
                    d=filtered_data[10]
                  }
              focus.attr("transform", "translate(" + x(d.Year) + "," + y(d.Value) + ")");
              focus.select("text").text(function() { return d.Value;});
              focus.select(".x-hover-line").attr("y2", height - y(d.Value));
              focus.select(".y-hover-line").attr("x2", width + width);
            
            }
  
})




}  

</script>

</html>